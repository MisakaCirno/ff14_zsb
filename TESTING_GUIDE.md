# 🧪 用户系统功能测试指南

## 测试准备
确保服务器正在运行：http://127.0.0.1:8000/

## 测试步骤

### 1️⃣ 测试昵称设置功能

#### 步骤：
1. 使用管理员账户登录
   - 用户名: `admin`
   - 密码: `admin123`

2. 点击右上角用户名下拉菜单

3. 选择"个人资料"或直接访问 http://127.0.0.1:8000/profile/edit/

4. 在"昵称"字段输入测试昵称，例如：`光之战士`

5. 在"个人简介"字段添加描述，例如：`FFXIV 玩家，喜欢分享战术板配置`

6. 点击"保存修改"

#### 验证：
- ✅ 页面顶部显示成功消息
- ✅ 右上角导航栏显示昵称而非用户名
- ✅ 刷新页面，昵称仍然显示

---

### 2️⃣ 测试昵称在分享中的显示

#### 步骤：
1. 创建一个新分享（如果还没有）
   - 点击"创建分享"按钮
   - 填写标题：`测试战术板`
   - 粘贴战术板代码：`[stgy:a0+k-wvprSQA8rHpf1cY9Fk5R6ZNO5n7lvBSj9+rmE3OpbNbquadZFNuf34LKtB6Vvu+VwRuRlBjVWYHUviSUm70CoiZFyhI4mL2zvz2dqd2H+n24dmIzgMnUiI7BIEsAjEu6Yw8QNW73V4PV9for2+LXvcEt7lWK15eZwHDQojZm4juqzJiypDd5BkvBnZNs5j2tK]`
   - 添加描述：`这是一个测试分享`
   - 勾选"公开分享"
   - 提交

2. 回到主页 http://127.0.0.1:8000/

3. 查看分享卡片

#### 验证：
- ✅ 作者显示为昵称（`光之战士`）而非用户名（`admin`）
- ✅ 点击进入分享详情页
- ✅ 详情页也显示昵称

---

### 3️⃣ 测试密码修改功能

#### 步骤：
1. 访问 http://127.0.0.1:8000/profile/password/
   或点击导航栏用户下拉菜单 → "修改密码"

2. 填写表单：
   - 当前密码: `admin123`
   - 新密码: `newpassword123`
   - 确认新密码: `newpassword123`

3. 点击"修改密码"

#### 验证：
- ✅ 显示成功消息
- ✅ 自动跳转到个人资料页
- ✅ 仍然保持登录状态（没有被退出）

4. 测试新密码：
   - 点击"退出登录"
   - 使用新密码登录
   - 用户名: `admin`
   - 密码: `newpassword123`

#### 验证：
- ✅ 能够成功登录
- ✅ 旧密码不再有效

---

### 4️⃣ 测试密码修改验证

#### 步骤：
1. 再次访问 http://127.0.0.1:8000/profile/password/

2. 测试错误的当前密码：
   - 当前密码: `wrongpassword`（错误密码）
   - 新密码: `anotherpassword123`
   - 确认新密码: `anotherpassword123`

3. 点击"修改密码"

#### 验证：
- ✅ 显示错误消息
- ✅ 密码未被修改

4. 测试密码不匹配：
   - 当前密码: `newpassword123`（正确）
   - 新密码: `password1`
   - 确认新密码: `password2`（不匹配）

5. 点击"修改密码"

#### 验证：
- ✅ 显示错误消息
- ✅ 密码未被修改

---

### 5️⃣ 测试注册新用户自动创建 Profile

#### 步骤：
1. 退出当前账户

2. 访问 http://127.0.0.1:8000/register/

3. 注册新用户：
   - 用户名: `testuser`
   - 密码: `testpass123`
   - 确认密码: `testpass123`

4. 注册成功后，自动登录

5. 访问个人资料页 http://127.0.0.1:8000/profile/edit/

#### 验证：
- ✅ 能够正常访问个人资料页
- ✅ 昵称字段为空（显示用户名）
- ✅ 账户信息正确显示

---

### 6️⃣ 测试昵称清空功能

#### 步骤：
1. 在个人资料页，清空昵称字段

2. 点击"保存修改"

3. 查看导航栏和分享页面

#### 验证：
- ✅ 导航栏显示用户名而非昵称
- ✅ 分享页面显示用户名
- ✅ 功能正常回退到显示用户名

---

### 7️⃣ 测试账户信息显示

#### 步骤：
1. 访问个人资料页

2. 查看"账户信息"卡片

#### 验证：
- ✅ 注册时间正确显示
- ✅ 最后登录时间正确显示
- ✅ 邮箱显示（如果设置了）
- ✅ 分享数量正确显示

---

### 8️⃣ 测试用户下拉菜单

#### 步骤：
1. 确保已登录

2. 点击右上角用户名/昵称

#### 验证：
- ✅ 下拉菜单正确展开
- ✅ 包含以下选项：
  - 个人资料
  - 修改密码
  - 我的分享
  - 退出登录
- ✅ 每个链接都能正常工作

---

## 测试结果记录表

| 测试项 | 状态 | 备注 |
|--------|------|------|
| 昵称设置 | ⬜ |  |
| 昵称在分享中显示 | ⬜ |  |
| 密码修改成功 | ⬜ |  |
| 密码修改验证 | ⬜ |  |
| 新用户自动创建 Profile | ⬜ |  |
| 昵称清空功能 | ⬜ |  |
| 账户信息显示 | ⬜ |  |
| 用户下拉菜单 | ⬜ |  |

## 注意事项

- 测试过程中如果修改了管理员密码，请记录新密码
- 建议在浏览器隐私模式下测试注册功能
- 如遇到问题，检查浏览器控制台和服务器日志

## 常见问题

### Q: 页面显示 500 错误
A: 检查服务器终端的错误日志，可能是数据库或代码问题

### Q: 昵称没有显示
A: 确保已运行 `create_profiles.py` 为现有用户创建 UserProfile

### Q: 修改密码后被退出登录
A: 检查是否正确使用了 `update_session_auth_hash` 函数

---

**测试完成后，所有功能应该正常工作！** ✨
